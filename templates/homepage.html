<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Priority Encoder | Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            min-height: 100vh;
            background: linear-gradient(120deg, #fbc2eb 0%, #a6c1ee 100%);
            color: #222;
        }
        .dashboard-container {
            max-width: 950px;
            margin: 2rem auto;
            background: rgba(255,255,255,0.95);
            border-radius: 2rem;
            box-shadow: 0 4px 32px rgba(0,0,0,0.10);
            padding: 2.5rem 3rem;
        }
        .todo-icon {
            font-size: 2.5rem;
            color: #7f7fd5;
        }
        .table thead {
            background: linear-gradient(90deg, #a1c4fd 0%, #c2e9fb 100%);
        }
        .table tbody tr {
            vertical-align: middle;
        }
        .logout-btn {
            background: linear-gradient(90deg, #fbc2eb 0%, #a6c1ee 100%);
            border: none;
            color: #222;
        }
        .form-section label {
            font-weight: 500;
        }
        .form-section input, .form-section select {
            border-radius: 0.5rem;
            border: 1px solid #c2e9fb;
        }
        .form-section input[type="submit"] {
            background: linear-gradient(90deg, #a1c4fd 0%, #c2e9fb 100%);
            border: none;
            color: #222;
            font-weight: 600;
            border-radius: 0.5rem;
            margin-top: 0.5rem;
        }
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(120deg, #232526 0%, #414345 100%);
                color: #f3f3f3;
            }
            .dashboard-container {
                background: rgba(40,40,50,0.97);
                color: #f3f3f3;
            }
            .table thead {
                background: linear-gradient(90deg, #232526 0%, #414345 100%);
                color: #f3f3f3;
            }
        }

        .modal-content, #dashboardHelpModal {
            background-color: #282832f7;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div class="todo-icon">ðŸ“‹</div>
            <div>
                <span class="fw-bold">Hey, {{qs.username}}</span>
                <a href="/home" class="btn logout-btn ms-3">Logout</a>
            </div>
        </div>
        <div class="mb-4">
            <form method="POST" action="/homepage" class="form-section row g-3">
                {% csrf_token %}
                <div class="col-md-5">
                    <label for="id_Description" class="form-label">Description:</label>
                    <input type="text" name="Description" id="id_Description" maxlength="100" required placeholder="e.g. Finish report" class="form-control">
                </div>
                <div class="col-md-4">
                    <label for="id_Type" class="form-label">Category:</label>
                    <select name="Type" id="id_Type" required class="form-select">
                        <option value="Curricular">Curricular</option>
                        <option value="Co-Curricular">Co-Curricular</option>
                        <option value="Extra-Curricular">Extra-Curricular</option>
                        <option value="Personal">Personal</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="id_Due_Date" class="form-label">Due Date:</label>
                    <input type="date" name="Due_Date" id="id_Due_Date" required class="form-control">
                </div>
                <div class="col-12">
                    <input type="submit" value="Add Task" class="w-100">
                </div>
            </form>
            <div class="mt-2">
                <button class="btn btn-link text-info" data-bs-toggle="modal" data-bs-target="#addTaskHelpModal">Help with fields</button>
            </div>
        </div>
        <h3 class="mb-3">Assigned</h3>
        <div class="table-responsive mb-5">
            <table class="table table-hover align-middle">
                <thead>
                    <tr>
                        <td>Description</td>
                        <td>Category</td>
                        <td>Weight</td>
                        <td>Date</td>
                        <td>Due Date</td>
                        <td>Actions</td>
                    </tr>
                </thead>
                <tbody>
                {% for i in tasks %}
                {% if not i.completed %}
                <tr>
                    <td>{{ i.task_desc }}</td>
                    <td>{{ i.task_type }}</td>
                    <td>{{ i.task_weight }}</td>
                    <td>{{ i.task_date }}</td>
                    <td>{{ i.task_due }}</td>
                    <td>
                        <a href="{% url 'delete_task' i.id %}" class="btn" style="color: white; background-color: #e57c7c;" onclick="return confirm('Are you sure you want to delete this task?');">Delete</a>
                        <a href="{% url 'mark_completed' i.id %}" class="btn" style="color:white; background-color: #a6c1ee;" onclick="return confirm('Do you surely want to mark this task as completed?');">Mark as Complete</a>
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
                </tbody>
            </table>
        </div>
        <h3 class="mb-3">Completed Tasks</h3>
        <div class="table-responsive">
            <table class="table table-success table-striped align-middle">
                <thead>
                    <tr>
                        <td>Description</td>
                        <td>Category</td>
                        <td>Date</td>
                        <td>Due Date</td>
                        <td>Actions</td>
                    </tr>
                </thead>
                <tbody>
                {% for i in tasks %}
                {% if i.completed %}
                <tr>
                    <td>{{ i.task_desc }}</td>
                    <td>{{ i.task_type }}</td>
                    <td>{{ i.task_date }}</td>
                    <td>{{ i.task_due }}</td>
                    <td><a href="{% url 'delete_task' i.id %}" class="btn" style="color: white; background-color: #e57c7c;" onclick="return confirm('Are you sure you want to delete this task?');">Delete</a></td>
                </tr>
                {% endif %}
                {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="mt-4">
            <button class="btn btn-link text-info" data-bs-toggle="modal" data-bs-target="#dashboardHelpModal">How to use this dashboard?</button>
        </div>
    </div>
    <!-- Add Task Help Modal -->
    <div class="modal fade" id="addTaskHelpModal" tabindex="-1" aria-labelledby="addTaskHelpModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addTaskHelpModalLabel">Task Fields Help</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <ul>
              <li><b>Description:</b> A short summary of your task.</li>
              <li><b>Category:</b> The category (e.g., Work, Study, Personal).</li>
              <li><b>Due Date:</b> The deadline for the task.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <!-- Dashboard Help Modal -->
    <div class="modal fade" id="dashboardHelpModal" tabindex="-1" aria-labelledby="dashboardHelpModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="dashboardHelpModalLabel">Dashboard Help</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <ul>
              <li>Add new tasks using the form above. Fill in all fields for best results.</li>
              <li>Assigned tasks are shown in the first table. Mark them as complete or delete them as needed.</li>
              <li>Completed tasks are shown below for your reference.</li>
              <li>Use the Logout button to exit your dashboard securely.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>